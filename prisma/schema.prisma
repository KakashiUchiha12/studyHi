datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "rhel-openssl-3.0.x", "debian-openssl-1.1.x"]
}

model Subject {
  id                String         @id @default(cuid())
  userId            String         @map("user_id")
  name              String
  color             String         @default("#3B82F6")
  description       String?
  code              String?
  credits           Int            @default(3)
  instructor        String?
  totalChapters     Int            @default(0) @map("total_chapters")
  completedChapters Int            @default(0) @map("completed_chapters")
  progress          Float          @default(0.0)
  nextExam          DateTime?      @map("next_exam")
  assignmentsDue    Int            @default(0) @map("assignments_due")
  order             Int            @default(0)
  createdAt         DateTime       @default(now()) @map("created_at")
  updatedAt         DateTime       @updatedAt @map("updated_at")
  chapters          Chapter[]
  studyGoals        StudyGoal[]
  studySessions     StudySession[]
  user              User           @relation(fields: [userId], references: [id], onDelete: Cascade)
  files             SubjectFile[]
  tasks             Task[]
  testMarks         TestMark[]
  materials         Material[]
  driveFolders      DriveFolder[]
}

model SubjectFile {
  id            String   @id @default(cuid())
  userId        String   @map("user_id")
  subjectId     String   @map("subject_id")
  fileName      String   @map("file_name")
  originalName  String   @map("original_name")
  fileType      String   @map("file_type")
  mimeType      String   @map("mime_type")
  fileSize      Int      @map("file_size")
  filePath      String   @map("file_path")
  thumbnailPath String?  @map("thumbnail_path")
  category      String   @default("OTHER")
  tags          String   @default("[]")
  description   String?
  isPublic      Boolean  @default(false) @map("is_public")
  downloadCount Int      @default(0) @map("download_count")
  viewCount     Int      @default(0) @map("view_count")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  subject       Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([subjectId])
  @@index([userId])
}

model User {
  id           String   @id @default(cuid())
  name         String
  username     String?  @unique
  email        String   @unique
  passwordHash String   @map("password_hash")
  image        String?
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  // Profile enhancements
  bio                String? @db.Text
  skillTags          Json?   @map("skill_tags")
  expertiseAreas     Json?   @map("expertise_areas")
  featuredProjectIds Json?   @map("featured_project_ids")

  // Social Relations
  socialProfile    SocialProfile?
  followers        Follows[]         @relation("following")
  following        Follows[]         @relation("follower")
  ownedCommunities Community[]       @relation("CommunityOwner")
  memberships      CommunityMember[]
  posts            Post[]
  comments         Comment[]
  likes            Like[]
  sentMessages     Message[]         @relation("MessageSender")
  receivedMessages Message[]         @relation("MessageReceiver")
  createdEvents    CommunityEvent[]
  eventAttendances EventAttendee[]

  calendarEvents    CalendarEvent[]
  dashboardSections DashboardSection[]
  documents         Document[]
  goals             Goal[]
  notifications     Notification[] @relation("NotificationRecipient")
  sentNotifications Notification[] @relation("NotificationSender")
  skills            Skill[]
  studyGoals        StudyGoal[]
  studySessions     StudySession[]
  subjects          Subject[]
  subjectFiles      SubjectFile[]
  tasks             Task[]
  testMarks         TestMark[]
  profile           UserProfile?
  userSettings      UserSettings?

  // Drive Relations
  drive                Drive?
  driveActivities      DriveActivity[]
  sentCopyRequests     CopyRequest[]   @relation("SentCopyRequests")
  receivedCopyRequests CopyRequest[]   @relation("ReceivedCopyRequests")

  // Course Relations
  instructorCourses Course[]           @relation("InstructorCourses")
  enrolledCourses   CourseEnrollment[]
  courseReviews     CourseReview[]
  courseBookmarks   CourseBookmark[]
  courseDiscussions CourseDiscussion[]
  quizAttempts      QuizAttempt[]
  chapterProgress   ChapterProgress[]
  userBadges        UserBadge[]

  // Classes Relations
  createdClasses          Class[]           @relation("ClassCreator")
  classMemberships        ClassMember[]     @relation("ClassMemberships")
  classPosts              ClassPost[]       @relation("ClassPostAuthor")
  postComments            PostComment[]     @relation("PostCommentAuthor")
  postLikes               PostLike[]        @relation("PostLikeUser")
  assignmentsCreated      Assignment[]      @relation("AssignmentTeacher")
  submissions             Submission[]      @relation("SubmissionStudent")
  gradedSubmissions       Submission[]      @relation("SubmissionGrader")
  classNotifications      ClassNotification[] @relation("ClassNotificationCreator")
  classResourcesUploaded  ClassResource[]   @relation("ClassResourceUploader")

  // Projects Relations
  projects        Project[]
  projectLikes    ProjectLike[]
  projectComments ProjectComment[]
  achievements    Achievement[]

  // Q&A Relations
  questions     Question[]
  answers       Answer[]
  questionVotes QuestionVote[]
  answerVotes   AnswerVote[]
}

model UserProfile {
  id             String   @id @default(cuid())
  userId         String   @unique @map("user_id")
  fullName       String   @map("full_name")
  university     String?
  program        String?
  currentYear    String?  @map("current_year")
  gpa            String?
  bio            String?
  profilePicture String?  @map("profile_picture")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")
  user           User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Goal {
  id          String     @id @default(cuid())
  userId      String     @map("user_id")
  title       String
  description String     @db.Text
  targetDate  DateTime   @map("target_date")
  category    String
  status      String     @default("active")
  order       Int        @default(0)
  createdAt   DateTime   @default(now()) @map("created_at")
  updatedAt   DateTime   @updatedAt @map("updated_at")
  user        User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  tasks       GoalTask[]

  @@index([userId])
  @@index([userId, order])
}

model GoalTask {
  id        String    @id @default(cuid())
  goalId    String    @map("goal_id")
  title     String
  completed Boolean   @default(false)
  dueDate   DateTime? @map("due_date")
  priority  String    @default("medium")
  order     Int       @default(0)
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  goal      Goal      @relation(fields: [goalId], references: [id], onDelete: Cascade)

  @@index([goalId])
  @@index([goalId, order])
}

model Skill {
  id          String           @id @default(cuid())
  userId      String           @map("user_id")
  name        String
  description String           @db.Text
  resources   String           @default("[]")
  order       Int              @default(0)
  createdAt   DateTime         @default(now()) @map("created_at")
  updatedAt   DateTime         @updatedAt @map("updated_at")
  user        User             @relation(fields: [userId], references: [id], onDelete: Cascade)
  objectives  SkillObjective[]

  @@index([userId])
  @@index([userId, order])
}

model SkillObjective {
  id          String    @id @default(cuid())
  skillId     String    @map("skill_id")
  title       String
  completed   Boolean   @default(false)
  description String?    @db.Text
  targetDate  DateTime? @map("target_date")
  order       Int       @default(0)
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")
  skill       Skill     @relation(fields: [skillId], references: [id], onDelete: Cascade)

  @@index([skillId])
  @@index([skillId, order])
}

model Document {
  id            String   @id @default(cuid())
  userId        String   @map("user_id")
  name          String
  originalName  String   @map("original_name")
  type          String
  mimeType      String   @map("mime_type")
  size          Int      @map("file_size")
  filePath      String   @map("file_path")
  thumbnailPath String?  @map("thumbnail_path")
  tags          String   @default("[]")
  isPinned      Boolean  @default(false) @map("is_pinned")
  viewCount     Int      @default(0) @map("view_count")
  order         Int      @default(0)
  uploadedAt    DateTime @default(now()) @map("uploaded_at")
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")
  user          User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([userId, order])
  @@index([userId, isPinned])
}

model Task {
  id            String    @id @default(cuid())
  userId        String    @map("user_id")
  subjectId     String?   @map("subject_id")
  title         String
  description   String?   @db.Text
  priority      String    @default("medium")
  status        String    @default("pending")
  dueDate       DateTime? @map("due_date")
  completedAt   DateTime? @map("completed_at")
  category      String    @default("general")
  estimatedTime Int?      @map("estimated_time")
  timeSpent     Int?      @map("time_spent")
  tags          String    @default("[]")
  progress      Float?
  order         Int       @default(0)
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  subject       Subject?  @relation(fields: [subjectId], references: [id])
  user          User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudySession {
  id              String   @id @default(cuid())
  userId          String   @map("user_id")
  subjectId       String?  @map("subject_id")
  durationMinutes Int      @map("duration_minutes")
  startTime       DateTime @map("start_time")
  endTime         DateTime @map("end_time")
  notes           String?  @db.Text
  efficiency      Float?
  sessionType     String?  @map("session_type")
  productivity    Float?
  topicsCovered   String?  @map("topics_covered")
  materialsUsed   String?  @map("materials_used")
  createdAt       DateTime @default(now()) @map("created_at")
  subject         Subject? @relation(fields: [subjectId], references: [id])
  user            User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model StudyGoal {
  id           String    @id @default(cuid())
  userId       String    @map("user_id")
  subjectId    String?   @map("subject_id")
  title        String
  targetHours  Int       @map("target_hours")
  currentHours Int       @default(0) @map("current_hours")
  deadline     DateTime?
  status       String    @default("active")
  createdAt    DateTime  @default(now()) @map("created_at")
  updatedAt    DateTime  @updatedAt @map("updated_at")
  subject      Subject?  @relation(fields: [subjectId], references: [id])
  user         User      @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model TestMark {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  subjectId String   @map("subject_id")
  testName  String   @map("test_name")
  testType  String   @map("test_type")
  score     Float
  maxScore  Float    @map("max_score")
  testDate  DateTime @map("test_date")
  notes     String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  mistakes  String?  @db.Text
  subject   Subject  @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model UserSettings {
  id                 String   @id @default(cuid())
  userId             String   @unique @map("user_id")
  taskReminders      Boolean  @default(true) @map("task_reminders")
  emailNotifications Boolean  @default(false) @map("email_notifications")
  pushNotifications  Boolean  @default(true) @map("push_notifications")
  reminderTime       String   @default("09:00") @map("reminder_time")
  studySessionAlerts Boolean  @default(true) @map("study_session_alerts")
  defaultStudyGoal   Int      @default(240) @map("default_study_goal")
  preferredStudyTime String   @default("18:00") @map("preferred_study_time")
  breakReminders     Boolean  @default(true) @map("break_reminders")
  breakDuration      Int      @default(15) @map("break_duration")
  theme              String   @default("system")
  dashboardLayout    String   @default("default") @map("dashboard_layout")
  showProgressBars   Boolean  @default(true) @map("show_progress_bars")
  compactMode        Boolean  @default(false) @map("compact_mode")
  autoBackup         Boolean  @default(true) @map("auto_backup")
  dataRetentionDays  Int      @default(365) @map("data_retention_days")
  createdAt          DateTime @default(now()) @map("created_at")
  updatedAt          DateTime @updatedAt @map("updated_at")
  user               User     @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Chapter {
  id             String     @id @default(cuid())
  subjectId      String     @map("subject_id")
  title          String
  description    String?    @db.Text
  order          Int
  isCompleted    Boolean    @default(false) @map("is_completed")
  estimatedHours Int        @default(2) @map("estimated_hours")
  createdAt      DateTime   @default(now()) @map("created_at")
  updatedAt      DateTime   @updatedAt @map("updated_at")
  subject        Subject    @relation(fields: [subjectId], references: [id], onDelete: Cascade)
  materials      Material[]

  @@unique([subjectId, order])
}

model Material {
  id          String   @id @default(cuid())
  chapterId   String?  @map("chapter_id")
  subjectId   String?  @map("subject_id")
  title       String
  type        String
  content     String?  @db.Text
  fileUrl     String?  @map("file_url")
  fileSize    Int?
  duration    Int?
  isCompleted Boolean  @default(false) @map("is_completed")
  order       Int
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  chapter     Chapter? @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  subject     Subject? @relation(fields: [subjectId], references: [id], onDelete: Cascade)

  @@index([chapterId])
  @@index([subjectId])
}

model DashboardSection {
  id           String   @id @default(cuid())
  userId       String   @map("user_id")
  sectionKey   String   @map("section_key")
  isExpanded   Boolean  @default(true) @map("is_expanded")
  order        Int
  isVisible    Boolean  @default(true) @map("is_visible")
  customHeight Int?     @map("custom_height")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  user         User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([userId, sectionKey])
}

model Notification {
  id        String   @id @default(cuid())
  userId    String   @map("user_id")
  type      String
  title     String
  message   String
  timestamp DateTime @default(now())
  read      Boolean  @default(false)
  actionUrl String?
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation("NotificationRecipient", fields: [userId], references: [id], onDelete: Cascade)
  senderId  String?  @map("sender_id")
  sender    User?    @relation("NotificationSender", fields: [senderId], references: [id], onDelete: SetNull)

  @@index([userId])
  @@index([read])
  @@index([timestamp])
}

model CalendarEvent {
  id                  String    @id @default(cuid())
  userId              String    @map("user_id")
  title               String
  start               DateTime
  end                 DateTime
  type                String
  description         String?
  location            String?
  priority            String
  completed           Boolean   @default(false)
  notificationEnabled Boolean   @default(false)
  notificationTime    Int       @default(15)
  color               String?
  recurringType       String?
  recurringInterval   Int?
  recurringEndDate    DateTime?
  createdAt           DateTime  @default(now()) @map("created_at")
  updatedAt           DateTime  @updatedAt @map("updated_at")
  user                User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId], map: "CalendarEvent_user_id_idx")
  @@index([start], map: "CalendarEvent_start_idx")
  @@index([type], map: "CalendarEvent_type_idx")
  @@index([completed], map: "CalendarEvent_completed_idx")
}

// Social Media Models

model SocialProfile {
  userId         String   @id @map("user_id")
  bio            String?  @db.Text
  location       String?
  banner         String?

  // Websites
  website       String?
  websiteLabel  String? @map("website_label")
  websiteUrl2   String? @map("website_url_2")
  websiteLabel2 String? @map("website_label_2")

  // Social Media
  githubUrl      String? @map("github_url")
  linkedinUrl    String? @map("linkedin_url")
  twitterUrl     String? @map("twitter_url")
  instagramUrl   String? @map("instagram_url")
  instagramLabel String? @map("instagram_label")
  youtubeUrl     String? @map("youtube_url")
  youtubeLabel   String? @map("youtube_label")
  whatsappUrl    String? @map("whatsapp_url")
  whatsappLabel  String? @map("whatsapp_label")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@map("social_profiles")
}

model Follows {
  followerId  String   @map("follower_id")
  followingId String   @map("following_id")
  follower    User     @relation("follower", fields: [followerId], references: [id])
  following   User     @relation("following", fields: [followingId], references: [id])
  createdAt   DateTime @default(now()) @map("created_at")

  @@id([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Community {
  id           String   @id @default(cuid())
  name         String
  description  String?  @db.Text
  ownerId      String   @map("owner_id")
  icon         String?
  coverImage   String?  @map("cover_image")
  isPrivate    Boolean  @default(false) @map("is_private")
  showInSearch Boolean  @default(true) @map("show_in_search")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")
  rules        String?  @db.Text

  owner    User              @relation("CommunityOwner", fields: [ownerId], references: [id])
  members  CommunityMember[]
  channels Channel[]
  posts    Post[]
  events   CommunityEvent[]

  @@index([ownerId])
}

model CommunityMember {
  id          String   @id @default(cuid())
  communityId String   @map("community_id")
  userId      String   @map("user_id")
  role        String   @default("member") // member, moderator, admin
  joinedAt    DateTime @default(now()) @map("joined_at")

  community Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  user      User      @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([communityId, userId])
  @@index([communityId])
  @@index([userId])
}

model CommunityEvent {
  id          String    @id @default(cuid())
  communityId String    @map("community_id")
  creatorId   String    @map("creator_id")
  title       String
  description String?
  startDate   DateTime  @map("start_date")
  endDate     DateTime? @map("end_date")
  location    String?
  coverImage  String?   @map("cover_image")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  community Community       @relation(fields: [communityId], references: [id], onDelete: Cascade)
  creator   User            @relation(fields: [creatorId], references: [id])
  attendees EventAttendee[]

  @@index([communityId])
}

model EventAttendee {
  id        String   @id @default(cuid())
  eventId   String   @map("event_id")
  userId    String   @map("user_id")
  status    String   @default("going") // going, maybe, not_going
  createdAt DateTime @default(now()) @map("created_at")

  event CommunityEvent @relation(fields: [eventId], references: [id], onDelete: Cascade)
  user  User           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([eventId, userId])
}

model Channel {
  id          String   @id @default(cuid())
  communityId String   @map("community_id")
  name        String
  type        String   @default("text") // text, voice, announcement
  description String?
  order       Int      @default(0)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  community Community @relation(fields: [communityId], references: [id], onDelete: Cascade)
  messages  Message[]

  @@index([communityId])
}

model Post {
  id             String   @id @default(cuid())
  content        String   @db.Text
  userId         String   @map("user_id")
  communityId    String?  @map("community_id")
  image          String?
  isAnnouncement Boolean  @default(false) @map("is_announcement")
  status         String   @default("published") // published, archived, draft
  viewCount      Int      @default(0) @map("view_count")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  user        User         @relation(fields: [userId], references: [id], onDelete: Cascade)
  community   Community?   @relation(fields: [communityId], references: [id], onDelete: Cascade)
  comments    Comment[]
  likes       Like[]
  attachments Attachment[]

  @@index([userId])
  @@index([communityId])
}

model Attachment {
  id        String   @id @default(cuid())
  url       String
  name      String?
  type      String // IMAGE, VIDEO, FILE
  size      Int?
  postId    String   @map("post_id")
  createdAt DateTime @default(now()) @map("created_at")

  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
}

model Comment {
  id        String   @id @default(cuid())
  content   String   @db.Text
  postId    String   @map("post_id")
  userId    String   @map("user_id")
  parentId  String?  @map("parent_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  post    Post      @relation(fields: [postId], references: [id], onDelete: Cascade)
  user    User      @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent  Comment?  @relation("CommentToComment", fields: [parentId], references: [id], onDelete: Cascade) // No, cascade might be tricky with self routing but let's try
  replies Comment[] @relation("CommentToComment")
  likes   Like[]

  @@index([postId])
  @@index([userId])
  @@index([parentId])
}

model Like {
  id        String   @id @default(cuid())
  postId    String?  @map("post_id")
  commentId String?  @map("comment_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  post    Post?    @relation(fields: [postId], references: [id], onDelete: Cascade)
  comment Comment? @relation(fields: [commentId], references: [id], onDelete: Cascade)
  user    User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([postId, userId])
  @@unique([commentId, userId]) // Ensure distinctness
  @@index([postId])
  @@index([commentId])
}

model Message {
  id         String   @id @default(cuid())
  content    String @db.Text
  fileUrl    String?  @db.Text @map("file_url")
  fileType   String?  @map("file_type")
  fileName   String?  @map("file_name")
  senderId   String   @map("sender_id")
  channelId  String?  @map("channel_id") // For community channels
  receiverId String?  @map("receiver_id") // For DMs
  isRead     Boolean  @default(false) @map("is_read")
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  sender   User     @relation("MessageSender", fields: [senderId], references: [id], onDelete: Cascade)
  receiver User?    @relation("MessageReceiver", fields: [receiverId], references: [id], onDelete: Cascade)
  channel  Channel? @relation(fields: [channelId], references: [id], onDelete: Cascade)

  @@index([senderId])
  @@index([receiverId])
  @@index([channelId])
}

// Drive/Cloud Storage Models

model Drive {
  id             String   @id @default(cuid())
  userId         String   @unique @map("user_id")
  storageUsed    BigInt   @default(0) @map("storage_used") // in bytes
  storageLimit   BigInt   @default(10737418240) @map("storage_limit") // 10GB in bytes
  bandwidthUsed  BigInt   @default(0) @map("bandwidth_used") // daily bandwidth
  bandwidthLimit BigInt   @default(10737418240) @map("bandwidth_limit") // 10GB daily
  bandwidthReset DateTime @default(now()) @map("bandwidth_reset")
  isPrivate      Boolean  @default(false) @map("is_private")
  allowCopying   String   @default("REQUEST") // "ALLOW", "REQUEST", "DENY"
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  user         User            @relation(fields: [userId], references: [id], onDelete: Cascade)
  files        DriveFile[]
  folders      DriveFolder[]
  activities   DriveActivity[]
  copyRequests CopyRequest[]

  @@map("drives")
}

model DriveFolder {
  id        String    @id @default(cuid())
  driveId   String    @map("drive_id")
  parentId  String?   @map("parent_id")
  name      String
  path      String // full path for easy querying
  isPublic  Boolean   @default(false) @map("is_public")
  subjectId String?   @map("subject_id") // Link to Subject if folder represents a subject
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  deletedAt DateTime? @map("deleted_at") // Soft delete for trash

  drive    Drive         @relation(fields: [driveId], references: [id], onDelete: Cascade)
  parent   DriveFolder?  @relation("FolderHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  children DriveFolder[] @relation("FolderHierarchy")
  subject  Subject?      @relation(fields: [subjectId], references: [id])
  files    DriveFile[]

  @@index([driveId])
  @@index([parentId])
  @@index([subjectId])
  @@map("drive_folders")
}

model DriveFile {
  id            String    @id @default(cuid())
  driveId       String    @map("drive_id")
  folderId      String?   @map("folder_id")
  originalName  String    @map("original_name")
  storedName    String    @unique @map("stored_name") // UUID-based filename
  fileSize      BigInt    @map("file_size") // in bytes
  mimeType      String    @map("mime_type")
  fileType      String    @map("file_type") // extension
  fileHash      String    @map("file_hash") // MD5/SHA256 for duplicate detection
  filePath      String    @map("file_path") // path on disk
  thumbnailPath String?   @map("thumbnail_path")
  isPublic      Boolean   @default(false) @map("is_public")
  downloadCount Int       @default(0) @map("download_count")
  viewCount     Int       @default(0) @map("view_count")
  description   String?
  tags          String    @default("[]") // JSON array
  createdAt     DateTime  @default(now()) @map("created_at")
  updatedAt     DateTime  @updatedAt @map("updated_at")
  deletedAt     DateTime? @map("deleted_at") // Soft delete for trash

  drive  Drive        @relation(fields: [driveId], references: [id], onDelete: Cascade)
  folder DriveFolder? @relation(fields: [folderId], references: [id], onDelete: Cascade)

  @@index([driveId])
  @@index([folderId])
  @@index([fileHash]) // For duplicate detection
  @@map("drive_files")
}

model DriveActivity {
  id         String   @id @default(cuid())
  driveId    String   @map("drive_id")
  userId     String   @map("user_id")
  action     String // "upload", "download", "delete", "rename", "move", "copy", "import"
  targetType String   @map("target_type") // "file", "folder"
  targetId   String   @map("target_id")
  targetName String   @map("target_name")
  metadata   String?  @default("{}") // JSON for additional info
  createdAt  DateTime @default(now()) @map("created_at")

  drive Drive @relation(fields: [driveId], references: [id], onDelete: Cascade)
  user  User  @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([driveId])
  @@index([userId])
  @@index([createdAt])
  @@map("drive_activities")
}

model CopyRequest {
  id          String   @id @default(cuid())
  fromUserId  String   @map("from_user_id")
  toUserId    String   @map("to_user_id")
  fromDriveId String   @map("from_drive_id")
  toDriveId   String   @map("to_drive_id")
  requestType String   @map("request_type") // "subject", "file", "folder"
  targetId    String   @map("target_id")
  status      String   @default("PENDING") // "PENDING", "APPROVED", "DENIED"
  message     String?
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  fromUser  User  @relation("SentCopyRequests", fields: [fromUserId], references: [id], onDelete: Cascade)
  toUser    User  @relation("ReceivedCopyRequests", fields: [toUserId], references: [id], onDelete: Cascade)
  fromDrive Drive @relation(fields: [fromDriveId], references: [id], onDelete: Cascade)

  @@index([fromUserId])
  @@index([toUserId])
  @@index([status])
  @@map("copy_requests")
}

// Course Management Models

model Course {
  id                 String  @id @default(cuid())
  userId             String  @map("user_id")
  title              String
  slug               String  @unique
  description        String? @db.Text
  shortDescription   String? @map("short_description")
  courseImage        String? @map("course_image")
  category           String
  difficulty         String  @default("beginner")
  language           String  @default("en")
  learningObjectives String? @map("learning_objectives") @db.Text
  requirements       String? @default("[]")

  price    Float   @default(0)
  currency String  @default("USD")
  isPaid   Boolean @default(false) @map("is_paid")

  status  String  @default("draft")
  isDraft Boolean @default(true) @map("is_draft")

  enrollmentCount Int   @default(0) @map("enrollment_count")
  viewCount       Int   @default(0) @map("view_count")
  averageRating   Float @default(0) @map("average_rating")
  ratingCount     Int   @default(0) @map("rating_count")

  publishedAt DateTime? @map("published_at")
  createdAt   DateTime  @default(now()) @map("created_at")
  updatedAt   DateTime  @updatedAt @map("updated_at")

  instructor    User                 @relation("InstructorCourses", fields: [userId], references: [id], onDelete: Cascade)
  modules       CourseModule[]
  enrollments   CourseEnrollment[]
  reviews       CourseReview[]
  bookmarks     CourseBookmark[]
  announcements CourseAnnouncement[]
  achievements  CourseAchievement[]

  @@index([userId])
  @@index([status])
  @@index([category])
  @@index([difficulty])
  @@map("courses")
}

model CourseModule {
  id          String   @id @default(cuid())
  courseId    String   @map("course_id")
  title       String
  description String?
  order       Int
  duration    Int?     // Total duration in minutes
  moduleImage String?  @map("module_image") // Module thumbnail URL
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  course   Course          @relation(fields: [courseId], references: [id], onDelete: Cascade)
  chapters CourseChapter[]

  @@unique([courseId, order])
  @@index([courseId])
  @@map("course_modules")
}

model CourseChapter {
  id          String   @id @default(cuid())
  moduleId    String   @map("module_id")
  title       String
  description String?  @db.Text
  order       Int
  duration    Int?     // Chapter duration in minutes
  isFree      Boolean  @default(false) @map("is_free")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  module      CourseModule       @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  sections    CourseSection[]
  discussions CourseDiscussion[]
  progress    ChapterProgress[]

  @@unique([moduleId, order])
  @@index([moduleId])
  @@map("course_chapters")
}

model CourseSection {
  id          String   @id @default(cuid())
  chapterId   String   @map("chapter_id")
  title       String
  contentType String   @map("content_type")
  content     String?  @db.Text
  videoUrl    String?  @map("video_url")
  fileUrl     String?  @map("file_url")
  fileName    String?  @map("file_name")
  fileSize    Int?     @map("file_size")
  filePath    String?  @map("file_path")
  order       Int
  duration    Int?     // Section duration in minutes
  sectionType String?  @map("section_type") // video, text, quiz, assignment
  imageUrl    String?  @map("image_url") // Section image/thumbnail
  images      String?  @db.Text // JSON array of image URLs
  attachments String?  @db.Text // JSON array of attachment URLs
  isPreview   Boolean  @default(false) @map("is_preview") // Free preview section
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  chapter CourseChapter @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  quiz    Quiz?

  @@unique([chapterId, order])
  @@index([chapterId])
  @@map("course_sections")
}

model Quiz {
  id             String   @id @default(cuid())
  sectionId      String   @unique @map("section_id")
  title          String
  description    String?
  passingScore   Int?     @map("passing_score")
  timeLimit      Int?     @map("time_limit")
  showAnswers    Boolean  @default(true) @map("show_answers")
  randomizeOrder Boolean  @default(true) @map("randomize_order")
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  section   CourseSection  @relation(fields: [sectionId], references: [id], onDelete: Cascade)
  questions QuizQuestion[]
  attempts  QuizAttempt[]

  @@map("quizzes")
}

model QuizQuestion {
  id             String   @id @default(cuid())
  quizId         String   @map("quiz_id")
  question       String   @db.Text
  questionType   String   @default("single") @map("question_type")
  options        String   @db.Text
  correctAnswers String   @map("correct_answers") @db.Text
  explanation    String?  @db.Text
  order          Int
  createdAt      DateTime @default(now()) @map("created_at")
  updatedAt      DateTime @updatedAt @map("updated_at")

  quiz Quiz @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@index([quizId])
  @@map("quiz_questions")
}

model QuizAttempt {
  id             String   @id @default(cuid())
  quizId         String   @map("quiz_id")
  userId         String   @map("user_id")
  answers        String   @db.Text
  score          Float
  totalQuestions Int      @map("total_questions")
  correctAnswers Int      @map("correct_answers")
  timeTaken      Int?     @map("time_taken")
  completedAt    DateTime @default(now()) @map("completed_at")

  quiz Quiz @relation(fields: [quizId], references: [id], onDelete: Cascade)
  user User @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([quizId])
  @@index([userId])
  @@map("quiz_attempts")
}

model CourseEnrollment {
  id             String    @id @default(cuid())
  courseId       String    @map("course_id")
  userId         String    @map("user_id")
  progress       Float     @default(0)
  completedAt    DateTime? @map("completed_at")
  lastAccessedAt DateTime  @default(now()) @map("last_accessed_at")
  enrolledAt     DateTime  @default(now()) @map("enrolled_at")

  course          Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user            User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  chapterProgress ChapterProgress[]

  @@unique([courseId, userId])
  @@index([userId])
  @@index([courseId])
  @@map("course_enrollments")
}

model ChapterProgress {
  id             String    @id @default(cuid())
  enrollmentId   String    @map("enrollment_id")
  chapterId      String    @map("chapter_id")
  userId         String    @map("user_id")
  isCompleted    Boolean   @default(false) @map("is_completed")
  completedAt    DateTime? @map("completed_at")
  lastAccessedAt DateTime  @default(now()) @map("last_accessed_at")

  enrollment CourseEnrollment @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)
  chapter    CourseChapter    @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  user       User             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([enrollmentId, chapterId])
  @@index([userId])
  @@map("chapter_progress")
}

model CourseReview {
  id        String   @id @default(cuid())
  courseId  String   @map("course_id")
  userId    String   @map("user_id")
  rating    Int
  comment   String?  @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([courseId])
  @@index([userId])
  @@map("course_reviews")
}

model CourseBookmark {
  id        String   @id @default(cuid())
  courseId  String   @map("course_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([courseId, userId])
  @@index([userId])
  @@map("course_bookmarks")
}

model CourseDiscussion {
  id           String   @id @default(cuid())
  chapterId    String   @map("chapter_id")
  userId       String   @map("user_id")
  parentId     String?  @map("parent_id")
  question     String   @db.Text
  answer       String?  @db.Text
  isInstructor Boolean  @default(false) @map("is_instructor")
  createdAt    DateTime @default(now()) @map("created_at")
  updatedAt    DateTime @updatedAt @map("updated_at")

  chapter CourseChapter      @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  user    User               @relation(fields: [userId], references: [id], onDelete: Cascade)
  parent  CourseDiscussion?  @relation("DiscussionReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies CourseDiscussion[] @relation("DiscussionReplies")

  @@index([chapterId])
  @@index([userId])
  @@index([parentId])
  @@map("course_discussions")
}

model CourseAnnouncement {
  id        String   @id @default(cuid())
  courseId  String   @map("course_id")
  title     String
  content   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")

  course Course @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@map("course_announcements")
}

model CourseAchievement {
  id          String  @id @default(cuid())
  courseId    String? @map("course_id")
  badgeType   String  @map("badge_type")
  title       String
  description String
  icon        String
  criteria    String  @db.Text

  course     Course?     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  userBadges UserBadge[]

  @@index([courseId])
  @@map("course_achievements")
}

model UserBadge {
  id            String   @id @default(cuid())
  userId        String   @map("user_id")
  achievementId String   @map("achievement_id")
  isVisible     Boolean  @default(true) @map("is_visible")
  earnedAt      DateTime @default(now()) @map("earned_at")

  user        User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  achievement CourseAchievement @relation(fields: [achievementId], references: [id], onDelete: Cascade)

  @@unique([userId, achievementId])
  @@index([userId])
  @@map("user_badges")
}

// Classes Feature Models (Google Classroom-inspired)

model Class {
  id                 String          @id @default(cuid())
  name               String
  description        String?         @db.Text
  subject            String?
  syllabus           String?         @db.Text
  schedule           String?
  room               String?
  coverImage         String?         @map("cover_image") // URL or color code
  icon               String?         @map("icon") // Class Icon URL
  bannerImage        String?         @map("banner_image") // Banner Image URL
  joinCode           String          @unique @map("join_code")
  isPrivate          Boolean         @default(false) @map("is_private")
  createdBy          String          @map("created_by")
  createdAt          DateTime        @default(now()) @map("created_at")
  updatedAt          DateTime        @updatedAt @map("updated_at")
  allowStudentPosts  Boolean         @default(true) @map("allow_student_posts")
  allowComments      Boolean         @default(true) @map("allow_comments")
  archived           Boolean         @default(false)
  
  creator            User            @relation("ClassCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  members            ClassMember[]
  posts              ClassPost[]
  assignments        Assignment[]
  notifications      ClassNotification[]
  resources          ClassResource[]
  
  @@index([createdBy])
  @@index([joinCode])
  @@map("classes")
}

model ClassMember {
  id                  String   @id @default(cuid())
  classId             String   @map("class_id")
  userId              String   @map("user_id")
  role                String   @default("student") // 'student', 'teacher', 'admin'
  status              String   @default("pending") // 'pending', 'approved', 'rejected'
  joinedAt            DateTime @default(now()) @map("joined_at")
  mutedNotifications  Boolean  @default(false) @map("muted_notifications")
  lastViewedAssignments DateTime? @map("last_viewed_assignments")
  
  class               Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  user                User     @relation("ClassMemberships", fields: [userId], references: [id], onDelete: Cascade)
  @@unique([classId, userId])
  @@index([classId])
  @@index([userId])
  @@index([status])
  @@map("class_members")
}

model ClassPost {
  id          String        @id @default(cuid())
  classId     String        @map("class_id")
  authorId    String        @map("author_id")
  type        String        @default("general") // 'announcement', 'material', 'assignment', 'question', 'general'
  title       String?
  content     String        @db.Text
  attachments String        @db.Text // JSON array of file URLs
  pinned      Boolean       @default(false)
  viewCount   Int           @default(0) @map("view_count")
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")
  
  class       Class         @relation(fields: [classId], references: [id], onDelete: Cascade)
  author      User          @relation("ClassPostAuthor", fields: [authorId], references: [id], onDelete: Cascade)
  comments    PostComment[]
  likes       PostLike[]
  assignment  Assignment?
  
  @@index([classId])
  @@index([authorId])
  @@index([type])
  @@index([pinned])
  @@map("class_posts")
}

model PostComment {
  id        String   @id @default(cuid())
  postId    String   @map("post_id")
  authorId  String   @map("author_id")
  content   String   @db.Text
  parentId  String?  @map("parent_id")
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  
  post      ClassPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  author    User      @relation("PostCommentAuthor", fields: [authorId], references: [id], onDelete: Cascade)
  parent    PostComment?  @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   PostComment[] @relation("CommentReplies")
  
  @@index([postId])
  @@index([authorId])
  @@index([parentId])
  @@map("post_comments")
}

model PostLike {
  id        String   @id @default(cuid())
  postId    String   @map("post_id")
  userId    String   @map("user_id")
  createdAt DateTime @default(now()) @map("created_at")
  
  post      ClassPost @relation(fields: [postId], references: [id], onDelete: Cascade)
  user      User      @relation("PostLikeUser", fields: [userId], references: [id], onDelete: Cascade)
  @@unique([postId, userId])
  @@index([postId])
  @@index([userId])
  @@map("post_likes")
}

model Assignment {
  id                  String       @id @default(cuid())
  classId             String       @map("class_id")
  postId              String       @unique @map("post_id") // Links to ClassPost
  teacherId           String       @map("teacher_id")
  title               String
  description         String       @db.Text
  points              Int          @default(100)
  dueDate             DateTime     @map("due_date")
  allowLateSubmission Boolean      @default(false) @map("allow_late_submission")
  maxFileSize         BigInt       @default(268435456) @map("max_file_size") // 256MB in bytes
  createdAt           DateTime     @default(now()) @map("created_at")
  updatedAt           DateTime     @updatedAt @map("updated_at")
  
  class               Class        @relation(fields: [classId], references: [id], onDelete: Cascade)
  post                ClassPost    @relation(fields: [postId], references: [id], onDelete: Cascade)
  teacher             User         @relation("AssignmentTeacher", fields: [teacherId], references: [id], onDelete: Cascade)
  submissions         Submission[]
  
  @@index([classId])
  @@index([teacherId])
  @@index([dueDate])
  @@map("assignments")
}

model Submission {
  id           String    @id @default(cuid())
  assignmentId String    @map("assignment_id")
  studentId    String    @map("student_id")
  files        String    @db.Text // JSON array of file URLs with metadata
  submittedAt  DateTime  @default(now()) @map("submitted_at")
  isLate       Boolean   @default(false) @map("is_late")
  grade        Int?
  feedback     String?   @db.Text
  gradedAt     DateTime? @map("graded_at")
  gradedBy     String?   @map("graded_by")
  
  assignment   Assignment @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  student      User       @relation("SubmissionStudent", fields: [studentId], references: [id], onDelete: Cascade)
  grader       User?      @relation("SubmissionGrader", fields: [gradedBy], references: [id])
  
  @@unique([assignmentId, studentId])
  @@index([assignmentId])
  @@index([studentId])
  @@index([gradedBy])
  @@map("submissions")
}

model ClassNotification {
  id        String   @id @default(cuid())
  classId   String   @map("class_id")
  type      String   // 'assignment', 'notice', 'test', 'important_file'
  title     String
  message   String   @db.Text
  createdAt DateTime @default(now()) @map("created_at")
  createdBy String   @map("created_by")
  
  class     Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  creator   User     @relation("ClassNotificationCreator", fields: [createdBy], references: [id], onDelete: Cascade)
  
  @@index([classId])
  @@index([createdBy])
  @@map("class_notifications")
}

model ClassResource {
  id          String   @id @default(cuid())
  classId     String   @map("class_id")
  uploadedBy  String   @map("uploaded_by")
  title       String
  description String?  @db.Text
  fileUrl     String   @map("file_url")
  fileType    String   @map("file_type")
  fileSize    BigInt   @map("file_size")
  category    String?
  uploadedAt  DateTime @default(now()) @map("uploaded_at")
  
  class       Class    @relation(fields: [classId], references: [id], onDelete: Cascade)
  uploader    User     @relation("ClassResourceUploader", fields: [uploadedBy], references: [id], onDelete: Cascade)
  
  @@index([classId])
  @@index([uploadedBy])
  @@map("class_resources")
}

// ============================================
// PROJECTS FEATURE
// ============================================

model Project {
  id       String @id @default(cuid())
  authorId String @map("author_id")
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title       String
  description String  @db.Text
  coverImage  String? @map("cover_image")

  category String?
  tags     Json?

  viewCount   Int     @default(0) @map("view_count")
  isFeatured  Boolean @default(false) @map("is_featured")
  isPublished Boolean @default(false) @map("is_published")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  sections  ProjectSection[]
  likes     ProjectLike[]
  comments  ProjectComment[]
  questions Question[]

  @@index([authorId])
  @@index([isPublished])
  @@index([createdAt])
  @@map("projects")
}

model ProjectSection {
  id        String  @id @default(cuid())
  projectId String  @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  order   Int
  title   String
  content String @db.Text

  images    Json?
  videoUrl  String? @map("video_url")
  videoType String? @map("video_type")
  websiteUrl String? @map("website_url")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([projectId])
  @@map("project_sections")
}

model ProjectLike {
  id        String  @id @default(cuid())
  projectId String  @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([projectId, userId])
  @@index([projectId])
  @@index([userId])
  @@map("project_likes")
}

model ProjectComment {
  id        String  @id @default(cuid())
  projectId String  @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  content String @db.Text

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@index([projectId])
  @@index([userId])
  @@map("project_comments")
}

// ============================================
// ACHIEVEMENTS
// ============================================

model Achievement {
  id     String @id @default(cuid())
  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)

  type        String
  title       String
  description String
  iconUrl     String?  @map("icon_url")
  earnedAt    DateTime @default(now()) @map("earned_at")

  @@index([userId])
  @@map("achievements")
}

// ============================================
// Q&A SECTION
// ============================================

model Question {
  id        String  @id @default(cuid())
  projectId String  @map("project_id")
  project   Project @relation(fields: [projectId], references: [id], onDelete: Cascade)

  authorId String @map("author_id")
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  title   String
  content String @db.Text
  viewCount Int @default(0) @map("view_count")

  isSolved   Boolean   @default(false) @map("is_solved")
  solvedAt   DateTime? @map("solved_at")
  solvedById String?   @map("solved_by_id")

  upvotes Int @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  answers       Answer[]
  questionVotes QuestionVote[]

  @@index([projectId])
  @@index([authorId])
  @@index([createdAt])
  @@map("questions")
}

model Answer {
  id         String   @id @default(cuid())
  questionId String   @map("question_id")
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  authorId String @map("author_id")
  author   User   @relation(fields: [authorId], references: [id], onDelete: Cascade)

  content String @db.Text

  isAccepted Boolean   @default(false) @map("is_accepted")
  acceptedAt DateTime? @map("accepted_at")

  upvotes Int @default(0)

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  answerVotes AnswerVote[]

  @@index([questionId])
  @@index([authorId])
  @@index([createdAt])
  @@map("answers")
}

model QuestionVote {
  id         String   @id @default(cuid())
  questionId String   @map("question_id")
  question   Question @relation(fields: [questionId], references: [id], onDelete: Cascade)

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  value  Int

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([questionId, userId])
  @@index([questionId])
  @@index([userId])
  @@map("question_votes")
}

model AnswerVote {
  id       String @id @default(cuid())
  answerId String @map("answer_id")
  answer   Answer @relation(fields: [answerId], references: [id], onDelete: Cascade)

  userId String @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  value  Int

  createdAt DateTime @default(now()) @map("created_at")

  @@unique([answerId, userId])
  @@index([answerId])
  @@index([userId])
  @@map("answer_votes")
}
